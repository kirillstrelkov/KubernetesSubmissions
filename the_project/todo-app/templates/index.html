<!DOCTYPE html>
<html>

<head>
    <title>The project App</title>
</head>

<body>
    <h1>The project App</h1>

    <img src="/image" alt="Random image" width="200" height="200" />

    <div class="todo-input-container">
        <form action="{{ .PostsUrl }}" method="post">
            <input type="text" name="body" placeholder="What needs to be done?">
            <button type="submit">Create todo</button>
        </form>
    </div>

    <h2>Todo:</h2>
    <ul id="todo-list">
        {{range .TodoPosts}}
        <li class="todo">
            {{ .Body }}
            <button onclick="markDone({{ .ID }})">Mark as done</button>
        </li>
        {{end}}
    </ul>

    <h2>Done:</h2>
    <ul id="done-list">
        {{range .DonePosts}}
        <li>{{.Body}}</li>
        {{end}}
    </ul>

    <div class="footer">
        DevOps with Kubernetes 2025
    </div>

    <script>
        async function markDone(id) {
            try {
                const todoUrl = `{{ .TodoUrl }}/${id}`;
                const resp = await fetch(todoUrl, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ done: true })
                });

                if (!resp.ok) {
                    const text = await resp.text();
                    alert('Failed: ' + resp.status + ' ' + text);
                    return;
                }
                location.reload();
            } catch (err) {
                alert('Request failed: ' + err);
            }
        }
    </script>
</body>

</html>